# HotMeal ç³»ç»Ÿéƒ¨ç½²æ‰‹å†Œ

æœ¬æ–‡æ¡£ç”¨äºæŒ‡å¯¼å°† HotMeal ç³»ç»Ÿéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæˆ–è¿œç¨‹æœåŠ¡å™¨ï¼ˆLinuxï¼‰ä¸­ï¼Œç¡®ä¿åç«¯ã€å‰ç«¯å’Œæ•°æ®åº“ç¨³å®šè¿è¡Œã€‚

---

## ä¸€ã€éƒ¨ç½²ç¯å¢ƒå‡†å¤‡

| ç»„ä»¶                 | æ¨èç‰ˆæœ¬      |
| -------------------- | ------------- |
| Python               | â‰¥ 3.12        |
| Node.js              | â‰¥ 18.0        |
| MySQL                | 8.0+          |
| Redis                | å¯é€‰ï¼ˆç¼“å­˜ï¼‰  |
| Linux OS             | Ubuntu 20.04+ |
| Nginx                | ç”¨äºåå‘ä»£ç†  |
| Supervisor / systemd | ç”¨äºè¿›ç¨‹å®ˆæŠ¤  |

---

## äºŒã€åç«¯éƒ¨ç½²ï¼ˆFlask + Gunicornï¼‰

### âœ… å®‰è£…ä¾èµ–ä¸è™šæ‹Ÿç¯å¢ƒ

```bash
cd backend
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### âœ… é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™æ•°æ®åº“è¿æ¥ã€å¯†é’¥ç­‰ä¿¡æ¯
```

### âœ… å¯åŠ¨ Gunicorn æœåŠ¡

```bash
gunicorn -w 4 -b 0.0.0.0:5000 "app:create_app()"
```

> å»ºè®®ä½¿ç”¨ Supervisor æˆ– systemd å®ˆæŠ¤è¿›ç¨‹ï¼Œé¿å…åå°é€€å‡ºã€‚

---

## HTTPS
ç”±äºå¾®ä¿¡å°ç¨‹åºå¼ºåˆ¶è¦æ±‚ HTTPSï¼Œä»¥ä¸‹æä¾›é¢å¤–è¯´æ˜

### ğŸ” å¯ç”¨æœ¬åœ° HTTPSï¼ˆå¼€å‘æµ‹è¯•ï¼‰

åœ¨æœ¬åœ°è°ƒè¯•é˜¶æ®µï¼Œå¯é€šè¿‡ Flask å†…å»º HTTPS æ¨¡å¼ä½¿ç”¨è‡ªç­¾åè¯ä¹¦å¯ç”¨ HTTPSã€‚æ“ä½œå¦‚ä¸‹ï¼š

#### â‘  ç”Ÿæˆè‡ªç­¾åè¯ä¹¦

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

```bash
mkdir cert
openssl req -x509 -newkey rsa:2048 -nodes -keyout cert/key.pem -out cert/cert.pem -days 365
```

å‘½ä»¤æ‰§è¡Œæ—¶ä¼šæç¤ºè¾“å…¥ä¿¡æ¯ï¼Œå»ºè®®å¦‚ä¸‹å¡«å†™ï¼ˆå¯ç›´æ¥å›è½¦è·³è¿‡ï¼‰ï¼š

```
Country Name:        CN
State:               Shanghai
Organization:        HotMeal
Common Name:         localhost
```

#### â‘¡ ä½¿ç”¨ HTTPS å¯åŠ¨ Flask æœ¬åœ°å¼€å‘æœåŠ¡å™¨

```bash
flask run --cert=cert/cert.pem --key=cert/key.pem
```

ç»ˆç«¯æç¤º `Running on https://127.0.0.1:5000` å³å¯åŠ¨æˆåŠŸã€‚æµè§ˆå™¨è®¿é—®æ—¶å¦‚æœ‰â€œè¯ä¹¦ä¸å®‰å…¨â€æç¤ºå¯å¿½ç•¥ï¼ˆè‡ªç­¾åè¯ä¹¦æ‰€è‡´ï¼Œä»…ç”¨äºæµ‹è¯•ï¼‰ã€‚

#### âš ï¸ æ³¨æ„

- æ­¤æ–¹å¼ä»…é€‚ç”¨äºæœ¬åœ°æµ‹è¯•ï¼Œ**ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Nginx + Let's Encrypt æ­£å¼è¯ä¹¦éƒ¨ç½²**ã€‚
- å¾®ä¿¡å°ç¨‹åºè¦æ±‚çº¿ä¸Šæ¥å£ä¸º HTTPSï¼Œéœ€åœ¨éƒ¨ç½²æ—¶é…ç½® Nginx 443 ç«¯å£ä¸ TLS è¯ä¹¦ã€‚


## ä¸‰ã€å‰ç«¯æ„å»ºä¸éƒ¨ç½²

### âœ… ç®¡ç†åå°æ„å»ºä¸éƒ¨ç½²ï¼ˆadmin-frontendï¼‰

HotMeal ç®¡ç†åå°åŸºäº Vue3 + Vite æ„å»ºï¼Œéœ€å°†å…¶æ‰“åŒ…ä¸ºé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²è‡³ Nginx æˆ–å…¶ä»–å‰ç«¯æœåŠ¡å™¨ã€‚

#### ğŸ“¦ æ„å»ºæ­¥éª¤

```bash
cd admin-frontend
npm install           # å®‰è£…ä¾èµ–
npm run build         # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```

- æ‰“åŒ…åçš„æ–‡ä»¶ä½äº `dist/` ç›®å½•ä¸­ã€‚
- è¯¥ç›®å½•å³ä¸ºçº¯é™æ€é¡µé¢ï¼Œå¯ç”¨äºä»»ä½•æ”¯æŒ HTML é™æ€æ‰˜ç®¡çš„æœåŠ¡å™¨ã€‚

#### ğŸ” æ„å»ºå‰é…ç½® API åœ°å€

è‹¥é¡¹ç›®ä¸­ä½¿ç”¨äº†ç¯å¢ƒå˜é‡ç®¡ç†æ¥å£åœ°å€ï¼ˆå¦‚ `VITE_BASE_API`ï¼‰ï¼Œéœ€æ ¹æ®å®é™…åç«¯åœ°å€è¿›è¡Œä¿®æ”¹ï¼š

```bash
# .env.production æ–‡ä»¶ç¤ºä¾‹ï¼ˆå¦‚æœ‰ï¼‰
VITE_BASE_API=http://yourserver.com/api
```

æˆ–åœ¨ `vite.config.js` ä¸­æŸ¥æ‰¾ `baseURL` ä»£ç†é…ç½®ã€‚

#### ğŸš€ éƒ¨ç½²è‡³ Nginx ç¤ºä¾‹

```bash
# å°† dist æ–‡ä»¶å¤¹ä¸Šä¼ è‡³æœåŠ¡å™¨
scp -r dist/ root@yourserver:/var/www/hotmeal-admin/

# ç¼–è¾‘ Nginx é…ç½®
```

```nginx
server {
    listen 80;
    server_name admin.yourdomain.com;

    location / {
        root /var/www/hotmeal-admin;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5000;
    }
}
```

- ç¡®ä¿ `/api/` è·¯ç”±å·²æ­£ç¡®ä»£ç†åˆ°åç«¯ Flask æœåŠ¡
- ç¡®ä¿ Vue è·¯ç”±æ¨¡å¼ä¸º `history` æ—¶å¯ç”¨äº† `try_files`ï¼Œé¿å…åˆ·æ–° 404

#### ğŸ› ï¸ è·¨åŸŸè¯´æ˜ï¼ˆCORSï¼‰

åç«¯éœ€å¯ç”¨è·¨åŸŸæ¨¡å— `Flask-CORS`ï¼š

```python
from flask_cors import CORS
CORS(app, supports_credentials=True)
```

æ¨èé™åˆ¶ä¸ºæŒ‡å®šæ¥æºï¼š

```python
CORS(app, origins=["http://admin.yourdomain.com"])
```

#### ğŸ” å¸¸è§é—®é¢˜

| é—®é¢˜                    | åŸå› è¯´æ˜                                      |
| ----------------------- | --------------------------------------------- |
| é¡µé¢åˆ·æ–° 404            | ç¼ºå°‘ `try_files $uri $uri/ /index.html;`      |
| æ¥å£è¯·æ±‚å¤±è´¥            | `VITE_BASE_API` é…ç½®é”™è¯¯ / åç«¯æœªå¯ CORS      |
| æ‰“åŒ…åæ ·å¼é”™ä¹±          | éƒ¨ç½²è·¯å¾„ä¸å¯¹ï¼ŒNginx `root` æœªæŒ‡å‘ dist æ–‡ä»¶å¤¹ |
| åç«¯åœ°å€ localhost æŠ¥é”™ | ç”Ÿäº§ç¯å¢ƒä¸­ä¸èƒ½ä½¿ç”¨ localhostï¼Œéœ€å†™å…¬ç½‘åŸŸå    |

---

### âœ… ç”¨æˆ·ç«¯æ„å»ºï¼ˆuser-frontendï¼Œå°ç¨‹åºï¼‰

```bash
cd user-frontend
# ä½¿ç”¨ HBuilderX æˆ– cli æ„å»ºä¸ºå¾®ä¿¡å°ç¨‹åºåŒ…
```

- ä¸Šä¼ è‡³å¾®ä¿¡å¼€å‘è€…å¹³å°å®¡æ ¸å¹¶å‘å¸ƒ

---

## å››ã€Nginx é…ç½®ç¤ºä¾‹

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        root /var/www/html;  # æŒ‡å‘ admin å‰ç«¯ dist ç›®å½•
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## äº”ã€æ•°æ®åº“åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰

```bash
# ç™»å½• MySQL åæ‰§è¡Œ SQL åˆå§‹åŒ–è„šæœ¬
mysql -u root -p < data/init.sql
```

---

## å…­ã€æ—¥å¿—ä¸å¤‡ä»½å»ºè®®

- æ—¥å¿—å¯å†™å…¥ `logs/` ç›®å½•å¹¶é…ç½®è½®è½¬ï¼ˆlogrotateï¼‰
- å»ºè®®å®šæœŸå¤‡ä»½ MySQL æ•°æ®åº“ï¼Œä½¿ç”¨ cron å®šæ—¶ä»»åŠ¡
- æ¨èä½¿ç”¨ sentryã€Prometheus ç­‰ç›‘æ§æœåŠ¡

---

## ä¸ƒã€å®‰å…¨ä¸ä¼˜åŒ–å»ºè®®

- å¼€å¯ HTTPSï¼ˆä½¿ç”¨ Letâ€™s Encrypt è¯ä¹¦ï¼‰
- è®¾ç½® `SECRET_KEY`ã€ç¦ç”¨è°ƒè¯•æ¨¡å¼
- å¯ç”¨è·¨åŸŸ CORS ç™½åå•æ§åˆ¶
- é˜²æ­¢ SQL æ³¨å…¥ã€XSSï¼ˆç”±åç«¯ ORM ä¸å‰ç«¯ç»„ä»¶å·²éƒ¨åˆ†é˜²æŠ¤ï¼‰
- é™åˆ¶æ¥å£é¢‘ç‡ï¼ˆå¦‚å¿…è¦æ—¶æ¥å…¥é™æµæ–¹æ¡ˆï¼‰

---

## å…«ã€æ€»ç»“

HotMeal æ”¯æŒæ ‡å‡†å‰åç«¯åˆ†ç¦»éƒ¨ç½²ï¼Œæ”¯æŒ Docker/Nginx/Gunicorn ç­‰é€šç”¨å·¥å…·ã€‚æ¨èåœ¨ Ubuntu æœåŠ¡å™¨ä¸Šä½¿ç”¨ systemd + Gunicorn + Nginx éƒ¨ç½²åç«¯ï¼ŒVite æ„å»ºå‰ç«¯é™æ€èµ„æºï¼Œæå‡ç³»ç»Ÿè¿è¡Œç¨³å®šæ€§ã€‚
